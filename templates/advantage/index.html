{% extends "advantage/base_advantage.html" %}

{% block title %}Ubuntu Advantage for Infrastructure{% endblock %}
{% block meta_description %}Ubuntu Advantage for Infrastructure offers a single, per-node packaging of the most comprehensive software, security and IaaS support in the industry, with OpenStack support, Kubernetes support included, and Livepatch, Landscape and Extended Security Maintenance to address security and compliance concerns.{% endblock %}
{% block meta_copydoc %}https://docs.google.com/document/d/1AW8wQu1Uvq0xFtd_c2JwNdic075MPOTx7k2KHqFPPeo/edit{% endblock meta_copydoc %}

{% block content %}

{% if openid %}
<section class="p-strip--suru-topped is-shallow" style="padding-top: 6rem">
  <div class="row">
    <div class="col-6">
      <h1>Ubuntu Advantage for Infrastructure</h1>
      {% if not enterprise_contracts %}
      <p>By using Ubuntu Avantage you agree to our <a href="/legal/ubuntu-advantage-service-description">terms and conditions</a>.</p>
      {% endif %}
    </div>

    <div class="col-6 p-card">
      <p>
        You are signed in as {{ openid.fullname }} ({{ openid.email }})
      </p>
      <p>
        <a href="/logout?return_to={{ request.host_url }}advantage" class="p-button--neutral u-no-margin--bottom" onclick="dataLayer.push({
          'event' : 'GAEvent',
          'eventCategory' : 'Advantage',
          'eventAction' : 'Authentication',
          'eventLabel' : 'Sign out',
          'eventValue' : undefined
        });">Sign out</a>
      </p>
    </div>
  </div>
</section>

<section class="p-strip--light is-shallow" style="overflow: visible;">
{% if enterprise_contracts %}
  <div class="row">
    <div class="col-12">
      <h2>Your enterprise subscriptions</h2>
      <table class="p-table-expanding p-table--advantage">
        <thead>
          <tr class="p-table__row">
            <th>Name</th>
            <th>UA</th>
            <th class="u-align--center">Livepatch</th>
            <th class="u-align--center">ESM</th>
            <th class="u-align--center">FIPS</th>
            <th class="u-align--center">CC-EAL</th>
            <th class="u-hide">&nbsp;</th>
            <th class="u-hide">&nbsp;</th>
            <th class="u-hide">&nbsp;</th>
            <th class="u-hide">&nbsp;</th>
          </tr>
        </thead>
        <tbody>
          {% for contract in enterprise_contracts %}
          <tr class="p-table__row">
            <td>{{ contract['contractInfo']['name'] }}</td>
            <td style="text-transform: capitalize">{{ contract['supportLevel'] }}</td>
            <td class="u-align--center">
              {% if contract['entitlements']['livepatch'] == True %}
              <button class="u-toggle" aria-controls="#expanded-row-livepatch-{{ loop.index }}" aria-expanded="false" data-shown-text="Hide" data-hidden-text="Show">
                <i class="p-icon--success"></i> <i class="p-icon--contextual-menu">Open</i>
              </button>
              {% else %}
              &mdash;
              {% endif %}
            </td>
            <td class="u-align--center">
              {% if contract['entitlements']['esm'] == True %}
              <button class="u-toggle" aria-controls="#expanded-row-esm-{{ loop.index }}" aria-expanded="false" data-shown-text="Hide" data-hidden-text="Show">
                <i class="p-icon--success"></i> <i class="p-icon--contextual-menu">Open</i>
              </button>
              {% else %}
              &mdash;
              {% endif %}
            </td>
            <td class="u-align--center">
              {% if contract['entitlements']['fips']  == True %}
              <button class="u-toggle" aria-controls="#expanded-row-fips-{{ loop.index }}" aria-expanded="false" data-shown-text="Hide" data-hidden-text="Show">
                <i class="p-icon--success"></i> <i class="p-icon--contextual-menu">Open</i>
              </button>
              {% else %}
              &mdash;
              {% endif %}
            </td>
            <td class="u-align--center">
              {% if contract['entitlements']['cc-eal']  == True %}
              <button class="u-toggle" aria-controls="#expanded-row-cc-eal-{{ loop.index }}" aria-expanded="false" data-shown-text="Hide" data-hidden-text="Show">
                <i class="p-icon--success"></i> <i class="p-icon--contextual-menu">Open</i>
              </button>                {% else %}
              &mdash;
              {% endif %}
            </td>

            <td id="expanded-row-livepatch-{{ loop.index }}" class="p-table-expanding__panel" aria-hidden="true">
              <div class="row">
                <div class="col-12 u-align--center">
                  <p class="u-no-margin--bottom u-no-padding--top u-no-max-width">To activate Livepatch: <code>sudo ua enable livepatch</code></p>
                </div>
              </div>
            </td>
            <td id="expanded-row-esm-{{ loop.index }}" class="p-table-expanding__panel" aria-hidden="true">
              <div class="row">
                <div class="col-12 u-align--center">
                  <p class="u-no-margin--bottom u-no-padding--top u-no-max-width">To activate ESM: <code>sudo ua enable esm-infra</code></p>
                  </div>
                </div>
              </div>
            </td>
            <td id="expanded-row-fips-{{ loop.index }}" class="p-table-expanding__panel" aria-hidden="true">
              <div class="row">
                <div class="col-12 u-align--center">
                  <p class="u-no-margin--bottom u-no-padding--top u-no-max-width">To activate FIPs: <code>sudo ua enable fips</code></p>
                </div>
              </div>
            </td>
            <td id="expanded-row-cc-eal-{{ loop.index }}" class="p-table-expanding__panel" aria-hidden="true">
              <div class="row">
                <div class="col-12 u-align--center">
                  <p class="u-no-margin--bottom u-no-padding--top u-no-max-width">To activate CC-EAL: <code>sudo ua enable cc-eal</code></p>
                </div>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <div class="row u-sv3">
    <div class="col-12 u-sv3" id="reveal-table">
      <a href="#reveal-table" class="p-button u-no-margin--bottom" id="js-reveal-table" aria-controls="enterprise-table" aria-expanded="false">Add another subscription <i class="p-icon--contextual-menu">Open</i></a>
      <div class="p-card--highlighted u-arrow-up u-hide" aria-hidden="true" id="enterprise-table">
        {% include "advantage/_table.html" %}
      </div>
    </div>
  </div>

{% endif %}
  <div class="row">
    <div class="col-6 u-sv3">
      <h2>Your free personal subscription</h2>
        <p>To attach a machine:</p>
        <pre style="border: 0; padding: 0;"><code>sudo ua attach {{ personal_account.free_token }}</code></pre>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <table>
        {% if personal_account['entitlements']['livepatch'] %}
        <tr class="row">
          <td class="col-2">Livepatch:</td>
          <td class="col-10"><pre style="border: 0; padding: 0;" class="u-no-margin--bottom"><code>sudo ua enable livepatch</pre></code></td>
        </tr>
        {% endif %}
        {% if personal_account['entitlements']['esm'] %}
        <tr class="row">
          <td class="col-2">ESM:</td>
          <td class="col-10"><pre style="border: 0; padding: 0;" class="u-no-margin--bottom"><code>sudo ua enable esm-infra</pre></code></td>
        </tr>
        {% endif %}
        {% if personal_account['entitlements']['fips'] %}
        <tr class="row">
          <td class="col-2">FIPS:</td>
          <td class="col-10"><pre style="border: 0; padding: 0;" class="u-no-margin--bottom"><code>sudo ua enable fips</code></pre></td>
        </tr>
        {% endif %}
        {% if personal_account['entitlements']['cc-eal'] %}
        <tr class="row">
          <td class="col-2">FIPS:</td>
          <td class="col-10"><pre style="border: 0; padding: 0;" class="u-no-margin--bottom"><code>sudo ua enable cc-eal</code></pre></td>
        </tr>
        {% endif %}
      </table>
    </div>
  </div>
  <div class="row">
    <div class="col-12">
        <p>For further options <a href="">visit the ua manpage</a>.</p>
    </div>
  </div>
</section>


{% if not enterprise_contracts %}
<section class="p-strip is-bordered">
  {% include "advantage/_table.html" %}
</section>
{% endif %}

{% else %}
<section class="p-strip--suru is-dark" style="padding-bottom: 10rem !important;">
  <div class="row">
    <div class="col-6">
      <h1>Ubuntu Advantage for Infrastructure</h1>
      <p>Ubuntu Advantage for Infrastructure is the most comprehensive Linux enterprise subscription, covering all aspects of open infrastructure.</p>
    </div>
    <div class="col-6 p-card">
      <h2 class="p-heading--four">Sign in or register</h2>
      <p class="u-no-margin--bottom">
        <a href="/login" class="p-button--positive" style="width: 6rem;"
          onclick="dataLayer.push({
            'event' : 'GAEvent',
            'eventCategory' : 'Advantage',
            'eventAction' : 'Authentication',
            'eventLabel' : 'Sign in',
            'eventValue' : undefined
          });">Sign in</a> to access your personal or paid subscriptions.
      </p>
      <p class="u-no-margin--bottom">
        <a href="/login" class="p-button--neutral"  style="width: 6rem;"
          onclick="dataLayer.push({
            'event' : 'GAEvent',
            'eventCategory' : 'Advantage',
            'eventAction' : 'Authentication',
            'eventLabel' : 'Register',
            'eventValue' : undefined
          });">Register</a> to get your free subscription.
      </p>
    </div>
  </div>
</section>

<section class="p-strip is-shallow is-bordered u-no-padding--top">
  {% include "advantage/_table.html" %}
</section>
{% endif %}

<section class="p-strip is-shallow">
  <div class="row">
    <div class="col-8">
      <h2>Got questions?</h2>
      <p>Let our experts help you in the right direction with Ubuntu Advantage.</p>
      <p><a href="/support/contact-us" class="p-button--positive js-invoke-">Contact us</a></p>
    </div>
  </div>
</section>


<script>
  function contextualMenu() {
    var contextualTables = document.querySelectorAll('.p-table-expanding');
    var toggles;

    contextualTables.forEach(function(table) {
      init(table);
    });

    function init(table) {
      toggles = table.querySelectorAll('.u-toggle');
      for (var i = 0; i < toggles.length; i++) {
        toggles[i].addEventListener('click', function (event) {
          var target = table.querySelector(
          this.getAttribute('aria-controls')
          );

          if (target.getAttributeNode("aria-hidden").value == 'true') {
            open(this);
          } else {
            close(this);
          }
        });
      }
    }

    function open(tab) {
      closeAll();
      var panel = document.querySelector(
      tab.getAttribute('aria-controls')
      );
      tab.setAttribute('aria-expanded', 'true');
      tab.parentNode.classList.add('p-table--open');
      tab.querySelector('.p-icon--contextual-menu').classList.add('u-rotate');
      panel.setAttribute('aria-hidden', 'false');
    }

    function close(tab) {
      var panel = document.querySelector(
      tab.getAttribute('aria-controls')
      );
      tab.setAttribute('aria-expanded', 'false');
      tab.parentNode.classList.remove('p-table--open');
      tab.querySelector('.p-icon--contextual-menu').classList.remove('u-rotate');
      panel.setAttribute('aria-hidden', 'true');
    }

    function closeAll() {
      toggles.forEach(function(toggle) {
        close(toggle);
      });
    }
  }

  contextualMenu();
</script>

<script>
  var toggle = document.querySelector('#js-reveal-table');
  var chevron = toggle.querySelector('.p-icon--contextual-menu');
  if (toggle && chevron) {
    toggle.addEventListener('click', function(e) {
      chevron.classList.toggle('u-rotate');
      var content = document.querySelector('#' + this.getAttribute('aria-controls'));
      content.classList.toggle('u-hide');
    });
  }
</script>

<script>
  function toggleMenu(element, show) {
    element.setAttribute('aria-expanded', show);
    document
    .querySelector(element.getAttribute('aria-controls'))
    .setAttribute('aria-hidden', !show);
  }

  function setupContextualMenuListeners(contextualMenuToggleSelector) {
    var toggles = document.querySelectorAll(contextualMenuToggleSelector);

    toggles.forEach(toggle => {
      toggle.addEventListener('click', e => {
        e.preventDefault();

        var target = e.target;
        var menuAlreadyOpen = target.getAttribute('aria-expanded') === 'true';

        toggleMenu(target, !menuAlreadyOpen)
      });
    });

    document.addEventListener('click', e => {
      toggles.forEach(toggle => {
        var contextualMenu = document.querySelector(toggle.getAttribute('aria-controls'));
        var clickOutside = !(toggle.contains(e.target) || contextualMenu.contains(e.target));

        if (clickOutside) {
          toggleMenu(toggle, false);
        }
      })
    });

    document.onkeydown = e => {
      e = e || window.event;

      if (e.keyCode === 27) {
        toggles.forEach(toggle => {
          toggleMenu(toggle, false);
        });
      }
    };
  }

  setupContextualMenuListeners('.p-contextual-menu__toggle');
</script>

{% with first_item="_support_landscape", second_item="_support_contact_us", third_item="_further_reading" %}{% include "shared/contextual_footers/_contextual_footer.html" %}{% endwith %}

{% endblock content %}

